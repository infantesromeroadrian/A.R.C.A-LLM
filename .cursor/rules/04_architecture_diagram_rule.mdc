---
alwaysApply: true
---
## ğŸ“ Directory Structure

### Mandatory Structure:

```
project-root/
â”œâ”€â”€ diagrams/
â”‚   â”œâ”€â”€ README.md                           # Diagrams index
â”‚   â”œâ”€â”€ architecture/
â”‚   â”‚   â”œâ”€â”€ 01_system_overview.drawio      # High-level system
â”‚   â”‚   â”œâ”€â”€ 02_data_pipeline.drawio        # Data flow
â”‚   â”‚   â”œâ”€â”€ 03_ml_pipeline.drawio          # ML workflow
â”‚   â”‚   â”œâ”€â”€ 04_deployment.drawio           # Deployment architecture
â”‚   â”‚   â””â”€â”€ 05_infrastructure.drawio       # Infrastructure details
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ data_preprocessing.drawio      # Data components
â”‚   â”‚   â”œâ”€â”€ model_architecture.drawio      # Model structure
â”‚   â”‚   â”œâ”€â”€ api_design.drawio              # API architecture
â”‚   â”‚   â””â”€â”€ database_schema.drawio         # Database design
â”‚   â”œâ”€â”€ flows/
â”‚   â”‚   â”œâ”€â”€ user_flow.drawio               # User interactions
â”‚   â”‚   â”œâ”€â”€ training_flow.drawio           # Training workflow
â”‚   â”‚   â”œâ”€â”€ inference_flow.drawio          # Prediction workflow
â”‚   â”‚   â””â”€â”€ monitoring_flow.drawio         # Monitoring process
â”‚   â”œâ”€â”€ exports/
â”‚   â”‚   â”œâ”€â”€ png/                           # PNG exports
â”‚   â”‚   â”œâ”€â”€ svg/                           # SVG exports
â”‚   â”‚   â””â”€â”€ pdf/                           # PDF exports
â”‚   â””â”€â”€ versions/
â”‚       â”œâ”€â”€ v1.0/                          # Version 1.0 diagrams
â”‚       â”œâ”€â”€ v2.0/                          # Version 2.0 diagrams
â”‚       â””â”€â”€ changelog.md                   # Diagram changelog
```

---

## ğŸ¨ When to Create Diagrams (Trigger)

### Diagram Creation is MANDATORY after:

1. âœ… Requirements gathering is **100% complete**
2. âœ… Requirements document is **approved by user**
3. âœ… Technical stack is **decided**
4. âœ… Architecture decisions are **made**

### Do NOT create diagrams if:
- âŒ Requirements are incomplete
- âŒ Architecture decisions are pending
- âŒ Technology stack is undecided
- âŒ Scope is still being defined

### Position in Workflow:
```
Requirements Gathering â†’ Architecture Diagrams â†’ Ticket Creation â†’ Development
      (Rule 1)                 (Rule 4)              (Rule 3)         (Rule 2)
```

---

## ğŸ“Š Types of Diagrams for AI/ML Projects

### 1. **System Overview Diagram** (Mandatory)
**Purpose:** High-level view of entire system

**Must Include:**
- All major components (frontend, backend, ML services, databases)
- External systems/APIs
- User interactions
- Data sources
- Deployment environment

**Example Components:**
```
[Web App] â†’ [API Gateway] â†’ [ML Service] â†’ [Vector DB]
                â†“               â†“
           [PostgreSQL]    [Model Registry]
```

---

### 2. **Data Pipeline Diagram** (Mandatory for Data-Heavy Projects)
**Purpose:** Show how data flows through the system

**Must Include:**
- Data sources (databases, APIs, files, streams)
- Data ingestion process
- Data preprocessing steps
- Data validation
- Data storage (data lake, warehouse, database)
- Data versioning
- Data access patterns

**Stages to Show:**
1. **Raw Data Collection**
2. **Data Cleaning**
3. **Data Transformation**
4. **Data Validation**
5. **Data Storage**
6. **Data Access**

---

### 3. **ML Pipeline Diagram** (Mandatory for ML Projects)
**Purpose:** Visualize machine learning workflow

**Must Include:**
- Data preprocessing
- Feature engineering
- Model training
- Model evaluation
- Model selection
- Hyperparameter tuning
- Model validation
- Model registry
- Model versioning

**Stages:**
```
Data â†’ Preprocessing â†’ Feature Engineering â†’ Training â†’ Evaluation â†’ Registry
         â†“                  â†“                    â†“          â†“
      Validation        Selection           Tuning    Versioning
```

---

### 4. **Deployment Architecture Diagram** (Mandatory)
**Purpose:** Show how system is deployed in production

**Must Include:**
- Cloud infrastructure (AWS/GCP/Azure)
- Containers (Docker)
- Orchestration (Kubernetes)
- Load balancers
- API gateways
- Databases
- Caching layers
- CDN (if applicable)
- Monitoring systems
- Logging systems

**Environments:**
- Development
- Staging
- Production

---

### 5. **Component Detail Diagrams** (As Needed)
**Purpose:** Deep dive into specific components

**Types:**
- **Model Architecture:** Neural network layers, connections
- **API Design:** Endpoints, request/response flow
- **Database Schema:** Tables, relationships, indexes
- **Security Architecture:** Authentication, authorization, encryption

---

### 6. **Flow Diagrams** (As Needed)
**Purpose:** Show process flows and user journeys

**Types:**
- **Training Flow:** How model training is triggered and executed
- **Inference Flow:** How predictions are made and returned
- **User Flow:** How users interact with the system
- **Monitoring Flow:** How system health is tracked

---

## ğŸ¨ Draw.io File Structure Template

Every .drawio file must follow this structure:

### File Header (XML):
```xml
<mxfile host="app.diagrams.net" modified="2025-10-02T00:00:00.000Z" 
        agent="AI Assistant" version="24.0.0" type="device">
  <diagram name="Diagram Name" id="unique-id">
    <mxGraphModel dx="1434" dy="844" grid="1" gridSize="10" 
                  guides="1" tooltips="1" connect="1" 
                  arrows="1" fold="1" page="1" 
                  pageScale="1" pageWidth="1169" pageHeight="827" 
                  math="0" shadow="0">
      <root>
        <!-- Diagram content goes here -->
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
```

---

## ğŸ¨ Draw.io Standards and Conventions

### Color Scheme for AI/ML Projects:

| Component Type | Color | Hex Code | Usage |
|----------------|-------|----------|-------|
| **Data Sources** | Blue | #4A90E2 | Databases, APIs, files |
| **Processing** | Green | #7ED321 | Data processing, transformations |
| **ML Components** | Purple | #BD10E0 | Models, training, inference |
| **Storage** | Orange | #F5A623 | Data storage, model registry |
| **APIs/Services** | Teal | #50E3C2 | REST APIs, microservices |
| **External** | Gray | #9B9B9B | Third-party services |
| **Security** | Red | #D0021B | Authentication, encryption |
| **Monitoring** | Yellow | #F8E71C | Logging, alerting |

### Shape Conventions:

| Shape | Usage | Example |
|-------|-------|---------|
| **Rectangle** | Services, components | API Server, ML Service |
| **Rounded Rectangle** | Processes, functions | Data Preprocessing, Training |
| **Cylinder** | Databases, storage | PostgreSQL, S3, Redis |
| **Cloud** | Cloud services | AWS, GCP, Azure |
| **Circle/Ellipse** | Start/End points | User, External API |
| **Diamond** | Decision points | If/Else, Validation |
| **Parallelogram** | Data/Input/Output | Dataset, Model Output |
| **Hexagon** | Machine Learning models | Neural Network, Random Forest |

### Arrow Conventions:

| Arrow Type | Usage |
|------------|-------|
| **Solid Arrow â†’** | Data flow, API calls |
| **Dashed Arrow â‡¢** | Asynchronous, optional |
| **Bold Arrow â®•** | Primary/critical path |
| **Bidirectional â†”** | Two-way communication |

### Text Standards:

- **Component Names:** Title Case, Bold
- **Descriptions:** Sentence case, Regular
- **Data Types:** UPPERCASE, Italic
- **Tech Stack:** Include version when relevant (e.g., "PostgreSQL 15")

### Layer Organization:

1. **Background Layer:** Grid, borders, containers
2. **Infrastructure Layer:** Cloud, networking, servers
3. **Application Layer:** Services, APIs, applications
4. **Data Layer:** Databases, storage, data flow
5. **Annotation Layer:** Labels, notes, legends

---

## ğŸ“‹ Diagram Documentation Template

Every diagram must have accompanying documentation:

### diagrams/README.md:

```markdown
# Project Architecture Diagrams

**Project:** [Project Name]  
**Version:** 1.0  
**Last Updated:** YYYY-MM-DD  
**Created By:** AI Assistant + User

---

## Quick Links

- [System Overview](#system-overview)
- [Data Pipeline](#data-pipeline)
- [ML Pipeline](#ml-pipeline)
- [Deployment](#deployment)
- [Components](#components)
- [Flows](#flows)

---

## Diagrams Index

### Architecture Diagrams

| Diagram | File | Purpose | Status |
|---------|------|---------|--------|
| System Overview | `architecture/01_system_overview.drawio` | High-level system view | âœ… Complete |
| Data Pipeline | `architecture/02_data_pipeline.drawio` | Data flow visualization | âœ… Complete |
| ML Pipeline | `architecture/03_ml_pipeline.drawio` | ML workflow | âœ… Complete |
| Deployment | `architecture/04_deployment.drawio` | Production architecture | âœ… Complete |
| Infrastructure | `architecture/05_infrastructure.drawio` | Infrastructure details | âœ… Complete |

### Component Diagrams

| Diagram | File | Purpose | Status |
|---------|------|---------|--------|
| Data Preprocessing | `components/data_preprocessing.drawio` | Data processing components | âœ… Complete |
| Model Architecture | `components/model_architecture.drawio` | ML model structure | âœ… Complete |
| API Design | `components/api_design.drawio` | API architecture | âœ… Complete |
| Database Schema | `components/database_schema.drawio` | Database design | âœ… Complete |

### Flow Diagrams

| Diagram | File | Purpose | Status |
|---------|------|---------|--------|
| User Flow | `flows/user_flow.drawio` | User interactions | âœ… Complete |
| Training Flow | `flows/training_flow.drawio` | Model training process | âœ… Complete |
| Inference Flow | `flows/inference_flow.drawio` | Prediction workflow | âœ… Complete |
| Monitoring Flow | `flows/monitoring_flow.drawio` | System monitoring | âœ… Complete |

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | YYYY-MM-DD | Initial diagrams created | AI Assistant |

---

## How to Use

### Viewing Diagrams:
1. Open .drawio files with [Draw.io Desktop](https://www.diagrams.net/) or [draw.io web](https://app.diagrams.net/)
2. Or view exported PNG/SVG files in `diagrams/exports/`

### Editing Diagrams:
1. Open .drawio file in Draw.io
2. Make changes
3. Save file
4. Export to PNG/SVG for documentation
5. Update version history
6. Commit changes to git

### Exporting Diagrams:
- **PNG:** For documentation, presentations (300 DPI)
- **SVG:** For scalable web display
- **PDF:** For printable documentation

---

## Diagram Conventions

### Colors:
- ğŸ”µ Blue (#4A90E2): Data Sources
- ğŸŸ¢ Green (#7ED321): Processing
- ğŸŸ£ Purple (#BD10E0): ML Components
- ğŸŸ  Orange (#F5A623): Storage
- ğŸ”· Teal (#50E3C2): APIs/Services
- âš« Gray (#9B9B9B): External
- ğŸ”´ Red (#D0021B): Security
- ğŸŸ¡ Yellow (#F8E71C): Monitoring

### Shapes:
- Rectangle: Services, Components
- Cylinder: Databases, Storage
- Cloud: Cloud Services
- Hexagon: ML Models
- Diamond: Decision Points

### Arrows:
- Solid (â†’): Data flow
- Dashed (â‡¢): Async/Optional
- Bold (â®•): Critical path
- Bidirectional (â†”): Two-way

---

## Key Insights from Diagrams

### System Architecture:
[Brief description of the overall architecture approach]

### Data Flow:
[Description of how data moves through the system]

### ML Pipeline:
[Description of the ML training and inference process]

### Scalability:
[How the architecture supports scaling]

### Security:
[Security measures visible in architecture]

---

## Related Documents

- Requirements Document: `docs/requirements.md`
- Ticket System: `tickets/README.md`
- Technical Decisions: `historyMD/decisions/`

---

**Last Updated:** YYYY-MM-DD  
**Maintained By:** AI Assistant + Development Team
```

---

## ğŸ¤– AI Assistant Behavior (Mandatory)

### âœ… At Diagram Creation (After Requirements, Before Tickets):

1. **Analyze approved requirements**
   - Identify all components mentioned
   - Identify all data flows
   - Identify all integrations
   - Understand deployment needs

2. **Create diagrams/ directory structure**
   - Create all subdirectories
   - Create README.md index
   - Prepare for multiple diagram types

3. **Create mandatory diagrams**
   - System Overview (always)
   - Data Pipeline (if data-intensive)
   - ML Pipeline (if ML project)
   - Deployment Architecture (always)

4. **Create component diagrams as needed**
   - Model architecture (if complex ML)
   - API design (if APIs involved)
   - Database schema (if databases used)

5. **Create flow diagrams as needed**
   - Training flow (if ML training)
   - Inference flow (if predictions)
   - User flow (if user-facing)

6. **Document each diagram**
   - Add description to README
   - Note key insights
   - Link to requirements

7. **Export diagrams**
   - PNG for documentation (300 DPI)
   - SVG for web (scalable)
   - PDF for printing (optional)

8. **Present to user for approval**
   - Show all diagrams
   - Explain architecture decisions
   - Get feedback and iterate
   - Update based on feedback

### âœ… During Diagram Creation:

1. **Follow color conventions**
   - Use standard colors for component types
   - Be consistent across diagrams

2. **Follow shape conventions**
   - Use standard shapes for element types
   - Make diagrams intuitive

3. **Add clear labels**
   - Label all components
   - Label all arrows/flows
   - Add legends when needed

4. **Show tech stack**
   - Include technology names
   - Include versions when relevant

5. **Show connections clearly**
   - Use appropriate arrow types
   - Show direction of data flow
   - Indicate async vs sync

6. **Group related elements**
   - Use containers for subsystems
   - Use colors for grouping
   - Use swim lanes for processes

### âœ… After Diagram Creation:

1. **Validate with requirements**
   - Ensure all requirements are represented
   - Check nothing is missing
   - Verify accuracy

2. **Update historyMD**
   - Log diagram creation decision
   - Document architecture rationale
   - Note key design choices

3. **Link to tickets**
   - Use diagrams to inform ticket creation
   - Reference components in tickets
   - Ensure tickets cover all diagram elements

4. **Version control**
   - Commit .drawio files to git
   - Commit exported images
   - Document initial version

### âŒ NEVER DO:

1. **âŒ Never skip diagrams** - Even if project seems simple
2. **âŒ Never create diagrams without requirements** - Requirements first
3. **âŒ Never create vague diagrams** - Be specific with component names
4. **âŒ Never ignore conventions** - Follow color/shape standards
5. **âŒ Never forget exports** - Always export to PNG/SVG
6. **âŒ Never forget documentation** - Always update README
7. **âŒ Never skip user approval** - Get feedback before proceeding

---

## ğŸ“ Example: Customer Churn Prediction Project

### Required Diagrams:

#### 1. System Overview (`01_system_overview.drawio`)

```
Components:
- Web Dashboard (React)
- API Gateway (FastAPI)
- Prediction Service (Python)
- Training Service (Python)
- PostgreSQL Database
- Redis Cache
- S3 Model Storage
- CloudWatch Monitoring

Connections:
- User â†’ Web Dashboard â†’ API Gateway
- API Gateway â†’ Prediction Service â†’ Redis Cache
- API Gateway â†’ Training Service â†’ PostgreSQL
- Training Service â†’ S3 (model storage)
- All â†’ CloudWatch
```

#### 2. Data Pipeline (`02_data_pipeline.drawio`)

```
Flow:
1. Raw Data (PostgreSQL) â†’ Data Extraction
2. Data Extraction â†’ Data Validation
3. Data Validation â†’ Data Cleaning
4. Data Cleaning â†’ Feature Engineering
5. Feature Engineering â†’ Data Storage (S3)
6. Data Storage â†’ Model Training

Validation Gates:
- Schema validation
- Quality checks
- Missing value thresholds
```

#### 3. ML Pipeline (`03_ml_pipeline.drawio`)

```
Flow:
1. Training Data (S3) â†’ Preprocessing
2. Preprocessing â†’ Feature Selection
3. Feature Selection â†’ Model Training
   - Random Forest
   - XGBoost
   - Neural Network
4. Model Training â†’ Evaluation
5. Evaluation â†’ Model Selection
6. Model Selection â†’ Model Registry (S3)
7. Model Registry â†’ Deployment

Parallel Paths:
- Hyperparameter tuning
- Cross-validation
- Performance monitoring
```

#### 4. Deployment Architecture (`04_deployment.drawio`)

```
Production Environment:
- AWS ECS Cluster
  - API Service (3 replicas)
  - Prediction Service (5 replicas)
- AWS RDS (PostgreSQL with read replicas)
- ElastiCache (Redis)
- S3 (Model storage)
- Application Load Balancer
- CloudFront CDN
- CloudWatch + Grafana

Dev/Staging:
- Simplified versions
- Single instances
```

---

## ğŸ“Š Diagram Quality Checklist

Before marking diagrams as complete, verify:

### Content Completeness:
- [ ] All components from requirements are represented
- [ ] All data sources are shown
- [ ] All external integrations are included
- [ ] All databases/storage are depicted
- [ ] All APIs/services are shown
- [ ] Technology stack is specified
- [ ] Versions are included (where relevant)

### Visual Quality:
- [ ] Colors follow conventions
- [ ] Shapes follow conventions
- [ ] Labels are clear and readable
- [ ] Arrows show direction
- [ ] Layout is clean and organized
- [ ] No overlapping elements
- [ ] Proper spacing and alignment

### Documentation:
- [ ] README.md updated with diagram list
- [ ] Each diagram has description
- [ ] Key insights documented
- [ ] Conventions legend included
- [ ] Version history started

### Technical Accuracy:
- [ ] Architecture is feasible
- [ ] Data flows are logical
- [ ] No circular dependencies (unless intentional)
- [ ] Scalability considerations shown
- [ ] Security measures depicted

### Exports:
- [ ] PNG exported (300 DPI)
- [ ] SVG exported (scalable)
- [ ] Files organized in exports/ directory
- [ ] File naming is consistent

### Integration:
- [ ] Linked from requirements document
- [ ] Referenced in upcoming tickets
- [ ] Logged in historyMD
- [ ] Committed to git

**Only when ALL items are checked can you proceed to ticket creation.**

---

## ğŸ”„ Diagram Versioning

### When to Create New Version:

- Major architecture changes
- New components added
- Significant refactoring
- Technology stack changes
- Deployment model changes

### Versioning Process:

1. **Create new version directory:** `diagrams/versions/v2.0/`
2. **Copy current diagrams:** Move current to v2.0
3. **Update diagrams:** Make changes in main directory
4. **Document changes:** Update changelog.md
5. **Export new versions:** Update PNG/SVG exports
6. **Update README:** Note version change
7. **Commit:** Git commit with version tag

### Changelog Format:

```markdown
# Diagrams Changelog

## Version 2.0 (YYYY-MM-DD)
### Changed
- Updated ML Pipeline to include new feature engineering step
- Added Redis caching layer to System Overview
- Modified Deployment to use Kubernetes instead of ECS

### Added
- New diagram: Real-time Streaming Architecture
- New component: Feature Store

### Removed
- Deprecated batch processing component

## Version 1.0 (YYYY-MM-DD)
- Initial architecture diagrams created
```

---

## ğŸ”— Integration with Other Rules

### Position in Complete Workflow:

```
1. Requirements Gathering (Rule 1)
   â†“
   [Requirements Document Approved âœ…]
   â†“
2. Architecture Diagrams (Rule 4) â† YOU ARE HERE
   â†“
   [Diagrams Approved âœ…]
   â†“
3. Ticket Creation (Rule 3)
   â†“
   [Tickets Created âœ…]
   â†“
4. Development (with History Logging - Rule 2)
   â†“
   [Project Complete]
```

### How Diagrams Inform Tickets:

- Each component in diagram â†’ Tickets for implementation
- Each data flow â†’ Tickets for integration
- Each external system â†’ Tickets for API integration
- Each database â†’ Tickets for schema and setup
- Each deployment element â†’ Tickets for infrastructure

**Example:**
```
Diagram Component: "PostgreSQL Database"
â†“
Creates Tickets:
- TICKET-001 [INFRA] Setup PostgreSQL database
- TICKET-002 [DATA] Design database schema
- TICKET-003 [INFRA] Configure database backups
- TICKET-004 [TEST] Database integration tests
```

### How Diagrams Use Requirements:

- Requirements define WHAT â†’ Diagrams show HOW
- Requirements text â†’ Visual architecture
- Functional requirements â†’ System components
- Non-functional requirements â†’ Infrastructure decisions
- Constraints â†’ Architecture patterns

---

## ğŸ“ Philosophy

> **"Architecture is not about code. It's about understanding the problem so well that the code becomes obvious."**

**Remember:**
- Diagrams force clear thinking about architecture
- Visual representation reveals gaps in requirements
- Early architecture prevents late refactoring
- Shared diagrams align team understanding
- Good diagrams make complex systems simple

**Diagrams serve multiple purposes:**
- **Planning:** Design before building
- **Communication:** Align team understanding
- **Documentation:** Explain to new team members
- **Validation:** Verify requirements are met
- **Maintenance:** Understand existing system

**Investment vs Return:**
- Time to create diagrams: 2-4 hours
- Time saved in development: 20-40 hours
- ROI: 10x or more

---

## ğŸ› ï¸ Tools and Resources

### Draw.io Resources:

- **Web App:** https://app.diagrams.net/
- **Desktop App:** https://www.diagrams.net/
- **VS Code Extension:** Draw.io Integration
- **Documentation:** https://www.diagrams.net/doc/

### Icon Libraries for AI/ML:

- AWS Architecture Icons
- GCP Architecture Icons
- Azure Architecture Icons
- Kubernetes Icons
- Database Icons
- ML/AI Icons

### Templates:

- Microservices Architecture Template
- ML Pipeline Template
- Data Pipeline Template
- Cloud Deployment Template

---

## âœ… Approval Checklist

Before proceeding to ticket creation, verify:

- [ ] All mandatory diagrams created (System, Data, ML, Deployment)
- [ ] All optional diagrams created (as needed for project)
- [ ] Color conventions followed consistently
- [ ] Shape conventions followed consistently
- [ ] All components labeled clearly
- [ ] All connections/flows shown
- [ ] Technology stack specified
- [ ] README.md index updated
- [ ] All diagrams exported (PNG/SVG)
- [ ] Exports organized in exports/ directory
- [ ] Diagrams documented (descriptions, insights)
- [ ] Version history initialized
- [ ] Diagrams committed to git
- [ ] User has reviewed and approved diagrams
- [ ] Architecture decisions logged in historyMD

**Only after ALL items are checked can ticket creation begin.**

---

**Version:** 1.0  
**Last Updated:** October 2025  
**Author:** AI Engineer Path - Cursor Rules  
**Status:** Mandatory for ALL Projects After Requirements Phase

